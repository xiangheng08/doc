# 洋葱模型

## 什么是洋葱模型？

洋葱模型是一种中间件架构模式，得名于其执行过程像剥洋葱一样层层深入再层层返回的特点。它广泛应用于 Node.js 的 Web 框架中，如 [Koa.js](https://github.com/koajs/koa)。

特点：

1. **双向执行流程**：
   - 请求阶段：从外层中间件向内层执行
   - 响应阶段：从内层中间件向外层返回

2. **控制权传递**：
   - 每个中间件通过 `next()` 函数将控制权传递给下一个中间件
   - 只有当后续中间件执行完毕后，才会回到当前中间件继续执行剩余代码

3. **错误处理**：
   - 可以在任意中间件捕获后续中间件抛出的错误
   - 提供统一的错误处理机制

## 基础版

<<< ./code/base.ts

::: details 使用示例

<<< ./code/test_base.ts

:::
