# 样式穿透

## 简介

在 Vue 开发中，当我们使用 scoped CSS 时，Vue 会自动为组件的元素添加唯一属性标识（如 `data-v-123456`），并相应地调整 CSS 选择器，使得样式只作用于当前组件。这种机制提供了组件样式隔离，防止样式冲突。

然而在某些场景下，我们需要父组件的样式能够作用于子组件内部的元素，这就需要用到**样式穿透**（Style Penetration）技术。

样式穿透主要用于以下场景：
- 修改第三方组件库的样式
- 自定义组件库中特定组件的样式
- 在不破坏组件封装的前提下，微调子组件样式

## Vue 2 中的实现方式

### 1. 使用 `>>>` 操作符

```css
/* 使用 >>> 操作符实现样式穿透 */
.parent >>> .child-component {
  color: red;
}
```

### 2. 使用 `/deep/` 伪类选择器

```scss
/* 在 SCSS/LESS 中使用 /deep/ */
.parent {
  /deep/ .child-component {
    color: blue;
  }
}
```

### 3. 使用 `::v-deep` 伪类选择器

```scss
/* 使用 ::v-deep 伪类选择器 */
.parent {
  ::v-deep .child-component {
    font-size: 16px;
  }
}
```

## Vue 3 中的实现方式

Vue 3 中废弃了 `>>>` 和 `/deep/`，推荐使用统一的 `:deep()` 语法。

### 1. 标准写法

```css
/* Vue 3 推荐的标准写法 */
:deep(.child-component) {
  border: 1px solid #ccc;
}
```

### 2. 结合预处理器使用

```scss
/* 在 SCSS 中使用 :deep() 语法 */
.parent {
  :deep(.child-component) {
    background: #f5f5f5;
  }
}

/* 或者直接使用 */
:deep(.child-component) {
  margin: 20px;
}
```

## 最佳实践

### 1. 优先使用 Vue 3 的 `:deep()` 语法
在 Vue 3 项目中，优先使用 `:deep()` 语法，这是官方推荐的方式。

### 2. 避免全局样式污染
始终将穿透样式限制在特定的父选择器内，避免样式泄漏到全局：

```scss
/* 推荐 */
.my-component {
  :deep(.target-element) {
    color: blue;
  }
}

/* 不推荐 */
:deep(.target-element) {
  color: blue;
}
```

### 3. 谨慎使用样式穿透
样式穿透会破坏组件的封装性，应该谨慎使用：
- 优先考虑通过 props 或 CSS 变量自定义样式
- 仅在必要时（如修改第三方组件样式）使用穿透

### 4. 预处理器注意事项
- SCSS 中 `>>>` 会被编译错误，应使用 `::v-deep` 或 `:deep()`
- LESS 中使用 `/deep/` 需要确保版本大于 3.5.0

### 5. 替代方案
考虑使用其他方式替代样式穿透：
- 使用 CSS Modules
- 使用 `:global` 修饰符
- 通过组件提供的自定义方式（如 CSS 变量、插槽等）

## 使用场景

1. **修改第三方组件库样式**
   当第三方组件库未提供足够的自定义选项时，可以使用样式穿透微调样式。

2. **自定义组件库**
   为团队内部组件库提供灵活的样式定制能力。

3. **特殊布局需求**
   在某些特殊布局场景下，需要跨越组件边界应用样式。

## 注意事项

- 样式穿透会破坏组件封装性，应谨慎使用
- 在团队项目中应统一使用规范，避免多种写法混用
- 升级 Vue 版本时需要注意语法兼容性问题
- 过度使用样式穿透会增加项目维护成本

> **重要提示**：样式穿透应仅用于必要场景，如修改第三方组件库样式，避免破坏组件的封装性和可维护性。
